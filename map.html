<!DOCTYPE html>
<html>
<head>
<meta charset=utf-8 />
<title>Places from Foursquare</title>
<meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
<script src='https://api.mapbox.com/mapbox.js/v2.4.0/mapbox.js'></script>
<link href='https://api.mapbox.com/mapbox.js/v2.4.0/mapbox.css' rel='stylesheet' />
<style>
  body { margin:0; padding:0; }
  #map { position:absolute; top:0; bottom:0; width:100%; }
</style>
</head>
<body>


<div id='map'></div>

<!-- jQuery is required for this example. -->
<script src='https://code.jquery.com/jquery-1.11.0.min.js'></script>
<script>
L.mapbox.accessToken = 'pk.eyJ1IjoiZ3JhZmEiLCJhIjoiY2lvZjU0NnRqMDB0cnVwbTM3MmZjeGxxZiJ9.HG76QROZVWnTf9jQ9ZKWDw';
var map = L.mapbox.map('map', 'mapbox.emerald')
    .setView([40, -74.50], 10);

// Credit Foursquare for their wonderful data
map.attributionControl
    .addAttribution('<a href="https://foursquare.com/">Places data from Foursquare</a>');

function getQueryVariable(variable) {
    var query = window.location.hash.substring(1);
    var vars = query.split('&');
    for (var i = 0; i < vars.length; i++) {
        var pair = vars[i].split('=');
        if (decodeURIComponent(pair[0]) == variable) {
            return decodeURIComponent(pair[1]);
        }
    }
    console.log('Query variable %s not found', variable);
}

var fsToken = getQueryVariable('access_token');

var API_ENDPOINT = 'https://api.foursquare.com/v2/users/self/venuelikes?ll=45,-122.5' +
  '&oauth_token=' + fsToken +
  '&v=20161020';

// Keep our place markers organized in a nice group.
var foursquarePlaces = L.layerGroup().addTo(map);

// Use jQuery to make an AJAX request to Foursquare to load markers data.

$.getJSON(API_ENDPOINT, function(result, status) {
        // Transform each venue result into a marker on the map.
        for (var i = 0; i < result.response.venues.items.length; i++) {
          var venue = result.response.venues.items[i];
          console.log(venue);
          var latlng = L.latLng(venue.location.lat, venue.location.lng);
          var marker = L.marker(latlng, {
              icon: L.mapbox.marker.icon({
                'marker-color': '#BE9A6B',
                'marker-symbol': 'cafe',
                'marker-size': 'large'
              })
            })
          .bindPopup('<strong><a href="https://foursquare.com/v/' + venue.id + '">' +
            venue.name + '</a></strong>')
            .addTo(foursquarePlaces);
        }

});

</script>

</body>
</html>